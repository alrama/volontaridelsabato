<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
<link rel="icon" href="favicon.ico" />
<link rel="stylesheet" href="paniniweb.css"/>
<script src="jquery-3.3.1.min.js"></script>
<script src="model.js"></script>
<script src="paniniweb.js"></script>
<script>
initModel(function(){
  if (user==undefined)
    location.replace("./login.html");
  else {
    loadVolontari(displayVolontari);
    if (user.admin) $("#account_plus").css('visibility','visible');
  }
});
function dettaglio_riga(elem,email) {
  $("#detail").css("display","block");
  $("#chiudi").css("display","inline");
  if (user.admin) $("#elimina").css("display","inline");
  $("#detail").css("top",elem.offsetTop+elem.offsetHeight);
  $("#detail").css("left",elem.offsetLeft);
  volont = findVolontario(email);
  $('#user').val(volont.email);
  $('#nome').val(volont.nome);
  $('#cognome').val(volont.cognome);
  $('#telefono').val(volont.cellulare);
  $('#admin').prop('checked',volont.admin);
}
function addaccount(elem) {
  $("#detail").css("display","block");
  $("#annulla").css("display","inline");
  $("#aggiungi").css("display","inline");
  $("#detail").css("top",elem.offsetTop+elem.offsetHeight);
  $("#detail").css("left",elem.offsetLeft-$("#detail").offsetWidth);
  $("#telefono_label").css("display","none");
  $("#telefono").css("display","none");
  $("#user").prop('disabled',false);
  $("#nome").prop('disabled',false);
  $("#cognome").prop('disabled',false);
  $("#admin").prop('disabled',false);
}
function rimuoviVolontario() {
  if (confirm("Attenzione. Il volontario sarà cancellato dall'anagrafica. Continuare ?")) {
    var req = {};
    req.onsuccess = function() {
      closeDetail();
      aggiornaVolontari();
    };
    req.onerror = function() {showMessage("Impossibile cancellare il volontario");};
    NetworkHelper.deleteVolontario($('#user').val(),req);
  }
}
function sendVolontario() {
  if ($('#nome').val()=="")
    showMessage("il nome proprio è obbligatorio");
  else {
    var vol = new Volontario();
    vol.email = $('#user').val();
    vol.nome = $('#nome').val();
    vol.cognome = $('#cognome').val();
    vol.admin = $('#admin').is(':checked');
    var req = {};
    req.onsuccess = function() {
      closeDetail();
      aggiornaVolontari();
    };
    req.onerror = function() {showMessage("Impossibile aggiungere il volontario");};
    NetworkHelper.sendVolontario(vol,req);
  }
}
function closeDetail() {
  $("#detail").css("display","none");
  $('#chiudi').css("display","none")
  $('#elimina').css("display","none")
  $('#annulla').css("display","none")
  $('#aggiungi').css("display","none")
  $('#user').val('');
  $('#nome').val('');
  $('#cognome').val('');
  $('#telefono').val('');
  $("#telefono_label").css("display","inline");
  $("#telefono").css("display","inline");
  $('#admin').prop('checked',false);
  $("#user").prop('disabled',true);
  $("#nome").prop('disabled',true);
  $("#cognome").prop('disabled',true);
  $("#admin").prop('disabled',true);
}
</script>
<title>Volontari del sabato</title>
</head>

<body>
  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a href="evento.html">Prossima distribuzione</a>
    <a href="volontari.html">Volontari</a>
    <a href="login.html">Login</a>
    <a href="register.html">Registrazione</a>
  </div>

  <!-- Use any element to open the sidenav -->
  <img onclick="openNav()" src="img/menu.png">
  <h2>Volontari del sabato</h2>
  <div class="message" id="message"></div>
  <div class="main">
    <div class="header_content">
      <img id="account_plus" onclick="addaccount(this);" src="img/account-plus.png" style="visibility:hidden" class="icon_header img_title">
    <img onclick="aggiornaVolontari();" src="img/sync.png" class="icon_header img_title"></div>
    <div id="volontari_content"></div>
  </div>
  <div id="detail" class="detail" style="display: none;">
    <label for="user" class="textsmall">e-mail di contatto</label><br/>
    <input type="email" class="smallfield" id="user" disabled><br/>
    <label for="nome" class="textsmall">nome</label><br/>
    <input type="text" class="smallfield" id="nome" disabled><br/>
    <label for="cognome" class="textsmall">cognome</label><br/>
    <input type="text" class="smallfield" id="cognome" disabled><br/>
    <label for="telefono" class="textsmall" id="telefono_label">telefono</label><br/>
    <input type="text" class="smallfield" id="telefono" disabled><br/>
    <input type="checkbox" id="admin" disabled><span class="textsmall"> Amministratore</span><br/>
    <input type="button" class="login compat_button" style="margin-top:5px;display:none" value="Chiudi" id="chiudi" onclick='closeDetail();'>
    <input type="button" class="login compat_button" style="margin-top:5px;display:none" value="Elimina" id="elimina" onclick='rimuoviVolontario();'>
    <input type="button" class="login compat_button" style="margin-top:5px;display:none" value="Annulla" id="annulla" onclick='closeDetail();'>
    <input type="button" class="login compat_button" style="margin-top:5px;display:none" value="Aggiungi" id="aggiungi" onclick='sendVolontario();'>
  </div>

</body>

</html>
