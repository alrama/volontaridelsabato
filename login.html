<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
<link rel="icon" href="favicon.ico" />
<link rel="stylesheet" href="paniniweb.css"/>
<script src="jquery-3.3.1.min.js"></script>
<script src="model.js"></script>
<script>
initModel(function() {
  if (location.hash) {
    var hash = window.location.hash.substring(1);
    $("#login_button").enabled = false;
    $("#message").text('Attendere ... connessione in corso');
    $.get("endregister.php?token="+hash,function(data,status) {
      serviceResponse = data;
      if (serviceResponse.response_code==200) {
        $("#message").html('Registrazione completata');
        if (user.email && user.password) login();
        else $("#message").html('Registrazione completata.<br/>Fare login con le credenziali indicate.')
      }
      else $("#message").text(serviceResponse.error_description);
    });
  }
  function login() {
    $("#message").text('Attendere ... connessione in corso');
    $.get("login.php?user="+user.email+"&pw="+user.password,function(data,status) {
      serviceResponse = data;
      if (serviceResponse.response_code==200) {
        user = serviceResponse.response;
        StorageHelper.saveUser(function() {
          location.href = "evento.html";
        });
      }
      else $("#message").text(serviceResponse.error_description);
    });
  }
});
</script>
<title>Volontari del sabato</title>
</head>

<body>
  <h2>Volontari del sabato</h2>
  <div class="message" id="message"></div>
  <div class="main">
    <label for="user">e-mail</label><br/>
    <input type="text" class="login" id="user"><br/>
    <label for="pwd">password</label><br/>
    <input type="password" class="login" id="pwd"><br/>
    <input type="button" class="login" onclick="login()" value="Accedi" id="login_button">
    <div class="textsmall">Primo accesso ?</div>
    <input type="button" class="login" onclick='location.href="./register.html";' value="Registrami">
  </div>
</body>

</html>
