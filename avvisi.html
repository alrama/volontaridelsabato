<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
<link rel="icon" href="favicon.ico" />
<link rel="stylesheet" href="paniniweb.css?v=2"/>
<script src="jquery-3.3.1.min.js"></script>
<script src="model.js?v=2"></script>
<script src="paniniweb.js?v=1"></script>
<script>
function setCounter() {
  $('#counter').text($('#testo_avviso').val().length+'/250');
}
function findNewAvvisi() {
  var req = {};
  req.onsuccess = function() {
    showMessage("");
    var prehtml = $('#avvisi').html();
    var html= "";
    for (var i = 0;i<avvisi.length;i++) {
      html+="<div class='subtitle'><span>"+avvisi[i].inserita+"</span>";
      html+="<div class='textsmall'><div style='display:inline'>" + avvisi[i].testo +") </div><span>" ;
      html+= "</div>";
    }
    $('#avvisi').html(html+prehtml);
  }
  var olddata = 0;
  if (avvisi && avvisi.length>0) olddata=avvisi[0].inserita;
  showMessage("Recupero ultimi avvisi in corso...");
  NetworkHelper.getAvvisi(olddata,req);
}
function displayAvvisi() {
  var html= "";
  for (var i = 0;i<avvisi.length;i++) {
    html+="<div class='subtitle'><span>"+avvisi[i].inserita+"</span>";
    html+="<div class='textsmall'><div style='display:inline'>" + avvisi[i].testo +") </div><span>" ;
    html+= "</div>";
  }
  $('#avvisi').html(html);
  findNewAvvisi();
}
initModel(function(){
  if (user==undefined)
    location.replace("./login.html");
  else {
    StorageHelper.getAvvisi(displayAvvisi);
    if (user.admin) $("#post_plus").css('visibility','visible');
  }
});
function scriviPost() {
  $("#detail").css("display","block");
}
function closeScrivi() {
  $("#detail").css("display","none");
}
</script>
<title>Volontari del sabato</title>
</head>

<body>
  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a href="evento.html">Prossima distribuzione</a>
    <a href="volontari.html">Volontari</a>
    <a href="avvisi.html">Avvisi</a>
    <a href="javascript:void(0)"  onclick="logout()">Logout</a>
    <a href="register.html">Registrazione</a>
  </div>

  <!-- Use any element to open the sidenav -->
  <img onclick="openNav()" src="img/menu.png">
  <h2>Avvisi</h2>
  <div class="message" id="message"></div>
  <div class="main">
    <div class="header_content">
      <img id="post_plus" onclick="scriviPost();" src="img/post-plus.png" style="visibility:hidden" class="icon_header img_title">
    <img onclick="refreshAvvisi();" src="img/sync.png" class="icon_header img_title"></div>
    <div id="avvisi"></div>
  </div>
  <div id="detail" class="detail" style="display: none;top:60px;">
    <label for="testo" class="textsmall">testo dell'avviso</label><br/>
    <textarea class="smallfield" id="testo_avviso" onkeyup="setCounter();" onchange="setCounter();" style="height:200px" maxlength="250"></textarea>
    <div style="text-align:right;width:200px"><span id="counter"/></div><br/>
    <input type="button" class="login compat_button" style="margin-top:5px" value="Chiudi" id="chiudi" onclick='closeScrivi();'>
    <input type="button" class="login compat_button" style="margin-top:5px" value="Invia" id="aggiungi" onclick='sendAvviso();'>
  </div>

</body>

</html>
